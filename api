=head1 NAME

EucaTest - Perl extension for Testing Eucalyptus on the QA infrastructure 

=head1 SYNOPSIS

use EucaTest
This module is intended to act on an Eucalyptus installation using euca2ools that are installed either locally or on a remote host. Both basic building blocks (ie running an arbitrary command on the remote machine) and high level test constructs (ie runnning an instance) are presented to allow test designers the highest level of flexibilty 

=head1 METHODS

Methods are broken down into Constructor, Test Helpers, Eucalyptus Operatons, Euare Operations

=head2 Constructor

=over 4

=item new( %OPTS )

Creates and returns a new EucaTest object. 
[LOCAL CONNECTION]
When no arguments are passed in the opts hash the default behavior is to start a local session.
[REMOTE CONNECTION]
In order to connect to a remote host the 'host' value must be passed in as follows: EucaTest->new({ host => "root:foobar\@myserver.org"})

Other optional parameters to pass in the %OPTS hash:
keypath=> this expects the path to a local private key file to use to authenticate the remote ssh session 
credpath=> path to where credentials for the DUT can be found (by default on creation of the EucaTest object it wil attempt to download its own credentials)
delay=> sets a sleep timer in between sending commands to the remote host. (DEFAULT: 0)
timeout=> timeout for any single command sent to the host (DEFAULT:120)
toolkit=> can choose whether to use euca- or ec2- commands, send string "ec2-" to change from the default of "euca-"

When the EucaTest object is created it will attempt to download admin credentials unless the credpath has been sent to the constructor. 
Each EucaTest object keeps a running log of the commands and output run against it.

=back

=head2 Test Helpers

=over 4

=item $test_session->fail($message)

Logs and prints "[TEST_REPORT] FAILED:  $message" and increments the FAIL_COUNT for the session in order to track failures to determine proper exit code

returns 0;

=item pass($message)	

Logs and prints "[TEST_REPORT] PASSED:  $message" 

=item test_name($name)

Logs and prints "******[TEST_REPORT] ACTION - $name ******

=item $test_session->log($message)

Logs $message

=item $test_session->tee($message)

Logs and prints $message

=item $test_session->attach_artifacts($exec_id)

Attaches artifacts found in ../artifacts/*.out to the given $exec_id in Testlink

returns 0 on success and -1 on failure

=item $test_session->cleanup([$testcase_id, $testplan_id])

If testcase_id and testplan_id are provided then it updates testlink with the running log then deletes .priv .log or credential files

=item $test_session->clear_log()

Set the running_log of the EucaTest instance to ""

=back

=head2 Eucalyptus Operations

=over 4

=item $test_session->add_group($groupname[, $rule])

Adds a security group rule to a Eucalyptus group. First checks to see if the group exists, if it doesn't exist it gets created with the name $groupname.
If no rule is provided then the default is to add authorizations for port 22 tcp (SSH) and for the ICMP protocol
Returns the groupname name if succeeded or -1 if its a failure

=item $test_session->add_keypair($keypair)

Adds a keypair named $keypair and stores the keyfile at ~/$keypair.priv
Returns the keypair name if succeeded or -1 if its a failure

=item $test_session->allocate_address()

Allocates an address.
Returns ip on success or -1 on failure.

=item $test_session->attach_volume($volume_id, $instance, $device)

Attaches the $volume to the $instance as $device.
Returns the $volume_id on success and -1 on failure

=item $test_session->create_snapshot($volume_id)

Creates a snapshot of the volume.
Returns the $snap_id on success and -1 on failure

=item $test_session->create_volume($zone, {size=> x}) or  $test_session->create_volume($zone, {snapshot=> x})
	
Creates a volume in the given availability zone $zone (required) using either the $size or snapshot given. If both options are provided the size takes precedent.
Returns the $volume_id on success and -1 on failure

=item $test_session->delete_bundle($bucket_name)

Deletes a bucket using the --clear flag to clear all objects and buckets.
Returns the 0 on success and -1 on failure

=item $test_session->delete_group($groupname)

Deletes a security group.
Returns the $groupname on success and -1 on failure

=back

=head2 EUARE Operations

None by default.


=head1 HISTORY

=over 8

=item 0.01

Original version; created by h2xs 1.23 with options

  -ACXn
	EucaTest is now working under the Eucalyptus QA system. 

=back



=head1 SEE ALSO

www.eucalyptus.com

=head1 AUTHOR

Victor Iglesias, E<lt>vic.iglesias@eucalyptus.comE<gt>

=head1 COPYRIGHT AND LICENSE

Copyright (C) 2011 by Victor Iglesias

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself, either Perl version 5.12.4 or,
at your option, any later version of Perl 5 you may have available.


=cut